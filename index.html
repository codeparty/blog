
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Derby blog</title>
  <meta name="author" content="Nate Smith and Brian Noguchi">

  
  <meta name="description" content="We&#8217;re happy to release the brand-spanking-new Derby 0.5! We&#8217;ve completely rewritten Racer, Derby&#8217;s realtime model layer on top of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.derbyjs.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Derby blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<style>
  article > footer { padding-bottom: 0 }
</style>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26625318-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Derby blog</a></h1>
  
    <h2>Full-stack MVC framework making it easy to write realtime, collaborative applications</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.derbyjs.com/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="http://derbyjs.com/">derbyjs.com</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="https://github.com/codeparty/derby">Github</a></li>
  <li><a href="http://twitter.com/derbyjs">Twitter</a></li>
  <li><a href="http://groups.google.com/group/derbyjs">Google Groups</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/04/derby-v0-dot-5-0/">Derby v0.5.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-04T10:00:00-07:00" pubdate data-updated="true">Jun 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We&#8217;re happy to release the brand-spanking-new <a href="http://derbyjs.com/">Derby 0.5</a>! We&#8217;ve completely rewritten Racer, Derby&#8217;s realtime model layer on top of <a href="http://sharejs.org/">ShareJS</a>. Derby 0.5 is the first full-featured web app framework with all data synced via Operational Transformation. It is also the first framework like it to support horizontal scaling to multiple servers. And while not new, Derby is still the only realtime framework with full support for server and client rendering with no extra code.</p>

<h2>OT&mdash;not just for Google anymore</h2>

<p><a href="http://en.wikipedia.org/wiki/Operational_transformation">Operational Transformation (OT)</a> is the technology that powers Google Docs, Google Wave, and a handful of other cutting-edge web apps. With OT, multiple users can simultaneously make changes to the same data. They can add, remove, and edit items in a shared list or edit the same text. Any conflicts are resolved in a way that is reliably consistent and aims to preserve each user&#8217;s intention.</p>

<p>Since all data in Derby uses OT, creating a realtime, collaborative text box is literally just <code>&lt;textarea&gt;{_page.text}&lt;/textarea&gt;</code>. Every textarea and input binding uses text OT by default, and every shared object can be collaboratively modified without any extra work.</p>

<p>Now, any developer can put together a collaborative app that would have taken a large team months just a few years ago. To demonstrate, <a href="https://github.com/enjalot">Ian</a> and <a href="https://github.com/josephg">Joseph</a> (with CSS loving from <a href="https://github.com/srhnhm">Sarah</a> and <a href="https://github.com/andreasmb">Andreas</a>) hacked together a collaborative story writing game yesterday afternoon:</p>

<h3><a href="http://stories.derbyjs.com/">Play it here!</a></h3>

<p>Then, check out <a href="https://github.com/codeparty/multiplayernotepad">the source</a> and see how it was made:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/V0DOGXmaT3g "></iframe></div>


<h2>Big steps toward production ready</h2>

<p>Derby and Racer are still very young, and a great deal of bug hunting, benchmarking, and hardening is in order.</p>

<p>However, this release is our first big step toward supporting production apps. With an appropriate proxy, Racer can now be used on multiple servers. It does require that clients are sticky to a given server, but it can quickly and gracefully reconnect to a new server if a connection is disrupted for any reason.</p>

<p>Racer now also has powerful ways to clean up client memory in complex apps. As users navigate between client-rendered pages, Derby automatically unsubscribes from and unloads documents no longer being used. It also removes old event listeners and state from the previous page. This is done intelligently, so data from the previous page still being used on the new page isn&#8217;t re-fetched from the server.</p>

<p>This code is hot off the keyboard, so it&#8217;s not for the faint of heart or IE. Expect bugs, and please help us to write tests!</p>

<h2>For those of you already on the bandwagon</h2>

<p>If you are already a Derby user, check out the <a href="/2013/06/04/migrating-from-derby-0-dot-3-to-0-dot-5/">previous post</a> for information about migrating.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/04/migrating-from-derby-0-dot-3-to-0-dot-5/">Migrating from Derby 0.3 to 0.5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-04T09:59:00-07:00" pubdate data-updated="true">Jun 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From Derby 0.3 to 0.5, Racer has been completely rewritten. Please see <a href="http://derbyjs.com/">the documentationn</a> for more detailed information, but this post should help you get started with upgrading your app.</p>

<h2>Migrating data in MongoDB</h2>

<p>The first thing you&#8217;ll need to know is that Racer now requires keeping a journal of all operations, which is stored in Redis. If this journal gets out of sync with the data in MongoDB, it will likely break your app. The journal is the main source of what is the current state, and the database is used to store a cache of the data at a particular snapshot. When fetching documents, the snapshot stored in the DB provides more efficient retrieval and query support. To get started, you&#8217;ll need to install <a href="http://redis.io/download">Redis 2.6</a>, then initialize the journal with the data stored in Mongo.</p>

<p>To make getting started with existing data a bit easier, we&#8217;ve written a <a href="https://github.com/share/igor">script to initialize the journal</a> in Redis based on a MongoDB database. There is also a <a href="https://github.com/share/godbox">tool to inspect your data</a> once it is initialized. For more info on using these tools, check out this video:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/FoOfNCJkAAA "></iframe></div>


<h2>Conceptual differences</h2>

<p>Overall, the core concepts in Racer remain mostly the same. However, we have made a few significant changes based on our experience with the previous version.</p>

<ul>
<li>Queries use the native database format. Racer 0.3 worked by defining a named queries on the server in advance. It used a special format that was then mapped to the database&#8217;s native query language. In Racer 0.5, queries are simply expressed in the native format of the database. Currently, we have implemented a MongoDB adapter, though it is possible to implement adapters for other databases as well.</li>
<li>The previous concept of the &#8220;speculative model&#8221; has been removed, since all remotely synced data is updated via operational transformation. The speculative model was a frequent source of frustration, and operational transformation is a superior approach to solving eventual consistency.</li>
<li>Private paths have been replaced with local and remote collections. Previously, private paths were any path containing a segment that started with an underscore. This allowed you to nest private paths underneath objects that were synced, but this was always buggy and complicated the implementation. In 0.5, every document is either local to a model or remote and synced back to the server and other clients. Local collection names (the very first path segment) start with an underscore (<code>_</code>) or dollar sign (<code>$</code>). All other collection names are remote. Collections starting with dollar sign are meant for internal use by Racer, Derby, and framework extensions. Your application should define local collections starting with underscore.</li>
<li>Subscriptions are only available at the document level. To greatly simplify the implementation of subscriptions and fetches, models may only subscribe or fetch an entire document. For now, this is also a limitation of access control, and a given client may only be allowed or prevented from getting an entire document. Eventually, access control will support filtering certain fields from certain users, but this is not completed yet.</li>
<li>Racer is now much simpler and more modular. It relies on ShareJS to handle remote data syncing, allows use of any connection layer instead of depending on Socket.IO, and has much less abstraction internally.</li>
</ul>


<h2>Specific API changes</h2>

<ul>
<li>Derby automatically cleans up data stored underneath <code>_page</code> immediately before each full page render on the client. This means that all private paths and refs should generally be moved to be underneath <code>_page</code></li>
<li>It is no longer possible to store data at a root private path, and it must be stored within a local document, now most likely underneath <code>_page</code></li>
<li>The MongoDB adapter adds <code>_v</code> and <code>_type</code> to keep track of internal state</li>
<li>Documents may have a type other than an object at their root. If a document is an object, its MongoDB document will correspond directly to the document. If it is another type, the Racer document will be nested underneath <code>_data</code> in MongoDB. This means that it is now possible to use paths like <code>hello.message</code>, which would be stored as a document such as <code>{_id: 'message', _data: 'Some text', _v: 1, _type: 'http://sharejs.org/types/JSONv0'}</code> in the <code>hello</code> collection</li>
<li>Document <code>id</code> properties are no longer mapped to and from the <code>_id</code> in Mongo</li>
<li>Derby automatically unsubscribes from all queries and documents subscribed on the previous page unless resubscribed in the next route</li>
<li><code>model.subscribe</code> and <code>model.fetch</code> only return an error argument. They no longer return scoped models corresponding to the inputs</li>
<li>Model events no longer correspond directly to method names. The model events are now <code>change</code>, <code>insert</code>, <code>remove</code>, <code>move</code>, <code>stringRemove</code>, <code>stringInsert</code>, <code>load</code>, <code>unload</code>, and <code>all</code></li>
<li>The path wildcard synatx for model events has changed slightly, and there are now both single segment wildcards (<code>*</code>) and multiple segment wildcards (<code>**</code>) at the end of a path</li>
<li>Model functions are defined based on names rather than bundled as strings. Similar to view helper functions, model functions are now defined based on a name and initialized via <code>model.start()</code>. This means that model functions can use closure scope as expected</li>
<li>Stores no longer have getter and setter methods. It is now necessary to create a model from a store to perform gets and sets</li>
<li>The previous afterDb hooks have been removed</li>
<li>Access control APIs have been changed</li>
<li><code>model.ref</code> no longer has a third <code>key</code> argument</li>
<li>Derby no longer generates and saves a file to disk for an app script bundle. Instead, the script is cached in memory and made available via middleware</li>
<li>The server configuration options have changed substantially. See <a href="https://github.com/codeparty/derby-examples">the examples</a> or <a href="http://derbyjs.com/#create_an_app">generate a new project</a> for reference</li>
</ul>


<p>If you have other migration questions or tips, please leave them in the comments to this post.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/10/preview-of-racer-0-dot-5-and-sharejs-for-scalable-derby-apps/">Preview of Racer 0.5 and ShareJS for scalable Derby apps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-10T10:52:00-07:00" pubdate data-updated="true">May 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Joseph and Nate have been sprinting on <a href="2013/03/26/getting-derby-ready-for-prime-time/">Racer 0.5 and updates to ShareJS</a>, which will soon be powering Derby applications. Racer has been completely rewritten to make it suitable for a production environment; it now scales horizontally across multiple servers and properly cleans up memory as new data is subscribed and unsubscribed. Based on our experience with the first version of Racer, we have also redesigned the code to be much more performant for complex application models.</p>

<p>We are still polishing off a few features, but want to show off an early preview of the upcoming hotness:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/uDzME15UxVM "></iframe></div>


<p>The new version is still undergoing rapid development and needs lots more testing, but you can watch our progress and play around with it by checking out the <a href="https://github.com/codeparty/racer/tree/0.5">Racer 0.5 branch</a> on GitHub. Derby has not yet been updated to work with the new Racer API, so you can&#8217;t use Racer 0.5 with Derby just yet.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/26/getting-derby-ready-for-prime-time/">Getting Derby ready for prime time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-26T12:41:00-07:00" pubdate data-updated="true">Mar 26<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At Lever, we believe that all web apps should be realtime. When you are looking at a page and it no longer reflects what someone else is seeing, that is a bug. In addition, we believe that web apps shouldn&#8217;t feel inferior to their desktop or mobile counterparts&mdash;they should load super quickly, respond to interaction instantly, and work offline without interruption.</p>

<p>We are creating Derby and Racer, intending to build the best technology to power the next generation of innovative web applications. We also aim to make their development accessible for individual developers, startups, and large teams.</p>

<h2>Welcome, Joseph!</h2>

<p>We&#8217;ll get back to our plan for achieving these ambitious goals, but first want to introduce <a href="http://josephg.com">Jospeh Gentle</a>, who recently joined the Lever team. Joseph has already built <a href="http://sharejs.org/">ShareJS</a>, perhaps the easiest open source library for adding Operational Transformation (OT) to a web app. OT is a method for enabling collaborative text editing and other forms of collaborative editing. Similar algorithms power Google Docs, Google Wave, Etherpad, and a handful of other advanced applications. Joseph was also previously a member of the Google Wave team, and is leading development of the next generation of our realtime infrastructure.</p>

<h2>In case you haven&#8217;t been following along yet</h2>

<p>Looking at the landscape of web frameworks and libraries a couple of years ago, we realized that while more and more applications were integrating realtime features, developer options were lacking.</p>

<p>We started by building Racer, the realtime data synchronization engine at Derby&#8217;s core. We focused first on innovating in the APIs and capabilities of the system, since there was little precedence for a generic realtime app data engine. There were many fantastic examples of realtime applications, such as chat, Google Docs and Wave, multi-player games, and financial platforms. However, they were by and large created by large organizations with massive resources. In contrast, clear patterns, standards, and frameworks had been established for server-rendered web apps and REST-backed client apps. Such tools were widely available to a variety of developers, including individuals and small companies.</p>

<p>On top of Racer, we built out Derby as a full-stack application framework with the capabilities of both a client-side single page application and a server-rendered Express app. Derby remains one of the very few solutions for taking advantage of full client and server code reuse, and it enables super fast page loads paired with immediate client-side updates.</p>

<p>We are now building a next generation application for companies to better manage their hiring. Our technology enables us to provide features unlike any other application in our market. At the same time, personally developing a full enterprise application helps us to test and improve the platform in a tight iteration loop.</p>

<h2>Establishing a solid foundation</h2>

<p>As with most new projects, we couldn&#8217;t foresee everything that would and wouldn&#8217;t work well. We wrote a whole lot of features and came up with a many new concepts as we created Racer and Derby. Many of these new ideas were fantastic, and many of them didn&#8217;t work well or made the implementation too complex. We also didn&#8217;t write the first version of the code to scale across multiple processes, since our focus was on innovating at the API level.</p>

<p>The next step in our development is simplifying down to the good ideas and making a horizontally scalable system. At the same time, we will be coordinating our work on ShareJS and Racer to better both projects.</p>

<p>The biggest part of the simplification work is moving away from Racer&#8217;s current fully arbitrary JSON structure object and replacing it with a mirror of Mongo&#8217;s collections and documents. The model API will stay the same, but we&#8217;ll be enforcing a collection and document topology consistently. This is already a requirement when using the Mongo adapter, and it is similar to how most other MVC frameworks structure their models.</p>

<p>Each collection will be a map from document ID to document data. Aside from access control filtering, each document will be present in the model or it won&#8217;t. Instead of trying to select out subsets of documents like a server-side Mongo query does, Racer will simply fetch each entire document that matches a query. We&#8217;ve learned that merging arbitrary document fragments from multiple queries introduces an excessive amount of complexity, and will likely be a big source of bugs without being particularly useful.</p>

<p>Over the next few months, we&#8217;re rewriting a great deal of Racer and refactoring ShareJS. Joseph is leading this effort and working on it full time. ShareJS will remain an independent project for those who only want to use its OT capabilities alongside their current stack. Integrating OT will help us to simplify some of the gnarlier parts of the model code while maintaining Racer&#8217;s simple API. What&#8217;s more, this will bring us much closer to proper offline support by default.</p>

<p>Racer will sit on top of ShareJS. ShareJS will provide the database layer, communication between servers and clients, and OT algorithms, and Racer will provide the model interface. Horizontal scaling support will be added into ShareJS itself, which is going to undergo a huge refactor to make the pieces fit nicely together. The highlights are:</p>

<ul>
<li>Splitting ShareJS into three smaller projects: OT types, a scaling database backend, and a glue project to expose an OT database to a web browser.</li>
<li>Moving to a collection/document view instead of a flat set of documents.</li>
<li>Support for live database queries.</li>
</ul>


<p>You can find a much more detailed description of the backend changes to ShareJS on <a href="http://josephg.com/post/45724165226/its-time-to-rewrite-sharejs">Joseph&#8217;s blog</a>.</p>

<p>These changes will be implemented in a bottom-up manner, so the changes to Racer will land last. In the meantime, we have been fixing bugs as they come up, but much of the current code is going to be removed or completely replaced over the next few months.</p>

<h2>Let&#8217;s meet!</h2>

<p>We&#8217;d also like to engage in a more open dialog with our community. We&#8217;ll be hosting a <a href="http://www.meetup.com/lever-open-source/events/111258232/">meetup next Wednesday, April 3</a> at our office in San Francisco. Hope to see you there!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/03/now-hiring-join-the-derby-core-team-at-lever/">Now hiring: Join the Derby core team at Lever</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-03T14:34:00-07:00" pubdate data-updated="true">Oct 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In addition to our continued development of Derby, Brian and I have started a company called <a href="https://lever.co/">Lever</a>. Lever is redefining talent software, starting with applicant tracking for hiring. With Lever, we aim to set the standard for next generation web apps, and we are hiring software engineers who share our ambitions.</p>

<h2>Innovate in web technology while solving real world problems</h2>

<p>We are building our product with Derby both to benefit from its unique capabilities and to put the technology to the test. Working at Lever means moving the ball forward on a product that our users love at the same time as contributing to the future of web app development. A big part of why we are hiring is to continue innovation on the framework itself. We have learned an incredible amount about how we can make Derby better by building a sophisticated app on top of it, and we are excited to make improvements.</p>

<p>You might wonder why we chose to write new software for tracking hiring. After interviewing managers at Square, Twitter, Yammer, AirBnB, Stripe, and other great companies, we learned that applicant tracking tools are ripe for disruption. Limited visibility into hiring data frustrates engineering managers trying to grow their teams, and difficult to use tools frustrate interviewers and recruiters alike. This is a unique opportunity where companies are already eager to adopt new enterprise software.</p>

<p>Lever’s culture is rooted in pairing technology innovation with user-driven design. We work right next to 50 of our users, directly learning how we can make each of their days a little better with every code push. Rather than defining our product by a list of features, we have reimagined applicant tracking around the candidate-company relationship.</p>

<h2>Sweet office in downtown San Francisco</h2>

<p>We are located in our pilot customer’s office in San Francisco. In addition to the best user feedback a team could ask for, we also get three free meals a day, free snacks, an office full of talented engineers and designers to learn from, and a spectacular roof deck.</p>

<h2>Learn a ton, and build a fantastic company</h2>

<p>As one of the very first hires at Lever, you will take a defining role in the company. You will have flexibility to contribute across the technology stack.</p>

<ul>
<li>Design and implement a wide variety of product features</li>
<li>Be a primary contributor to Derby, Racer, and other open source projects</li>
<li>Optimize search quality</li>
<li>Architect backend infrastructure</li>
<li>Administer servers</li>
<li>Create innovative data visualizations</li>
<li>Test and deploy every day</li>
</ul>


<h3>Technology</h3>

<p>Derby &amp; Racer, Node.js, HTML/CSS, Socket.IO, MongoDB, Solr, Git, and AWS</p>

<h3>Location</h3>

<p>San Francisco, CA</p>

<h3>Apply</h3>

<p><a href="mailto:jobs+blog@lever.co">jobs+blog@lever.co</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/04/19/derby-v0-dot-3-1/">Derby v0.3.1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-19T18:22:00-07:00" pubdate data-updated="true">Apr 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Derby v0.3.1 is out with support for LESS compilation, Express 3, easier to install examples, and a number of bug fixes.</p>

<h2>LESS</h2>

<p>Thanks to contributions from <a href="https://github.com/xcoderzach">Zach Smith</a>, Derby will now compile styles written in LESS as well as Stylus! We&#8217;re super excited to have new contributors, and it is great to see people using and improving upon the framework!</p>

<h2>Express 3</h2>

<p>We have updated Derby to use <a href="http://tjholowaychuk.com/post/21162751096/express-3-0-0-alpha1">Express 3</a>, which has recently been released in alpha. Express 3 is different in a number of small ways, so we wanted to get new projects started with the current APIs as soon as possible.</p>

<h2>Easier to get examples installed</h2>

<p>A number of people ran into issues running the derby examples on their machines, because of how they were included. They are now in a separate <a href="https://github.com/codeparty/derby-examples">GitHub repo</a> with much better installation instructions. Hopefully we have resolved all of the issues running Derby on Windows as well.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/04/14/our-take-on-derby-vs-meteor/">Our take on Derby vs. Meteor</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-14T12:14:00-07:00" pubdate data-updated="true">Apr 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We have received a number of requests for a comparison. I&#8217;d like to thank <a href="http://nickretallack.com/">Nick Retallack</a>, who already did a great job summarizing a lot of these points on our <a href="http://groups.google.com/group/derbyjs">Google Group</a>. Many of his observations are included here.</p>

<h2>A bit of the origin story</h2>

<p>First of all, I should mention that Brian and I first met the Meteor team last November when we demoed an early version of Derby at the <a href="http://krtconf.com/">Keeping it Realtime Conference</a> hosted by <a href="http://andyet.net/">&amp;yet</a>. When we met, the <a href="http://meteor.com/">Meteor</a> team had already started on their framework, and the similarities were obvious. Some time before, I had also met with David Greenspan (who recently joined Meteor) to pick his brain and learn more about his experience writing <a href="http://en.wikipedia.org/wiki/Etherpad">Etherpad</a>. Our two teams like each other, we&#8217;ve been keeping in touch, and we have all learned a lot from each other.</p>

<p>Our teams share a similar vision for a world where all applications are realtime and collaborative by default. We as well as a number of other other developers all had a revelation about a year and a half ago&#8212;the way that web apps are currently built makes it painfully difficult to create the best user experience, where data dynamically update everywhere.</p>

<p>Brian and I first discussed this vision with each other a year ago. I was coming from working as a Product Manager on the Google Search team, and he had been working on a number of open source Node.js projects including <a href="http://mongoosejs.com/">Mongoose</a> and <a href="http://everyauth.com/">everyauth</a>. I was interested in writing a framework, because I believed it was the best way to write an app with the kind of performance that I desired, and Brian felt that the Node.js community needed an easy to use framework for those developers who preferred tools like Rails and PHP.</p>

<h2>The Holy Grail: server and client code sharing</h2>

<p>From Google Search, I learned that in order to have a responsive web app, it is critical to both render pages on the server and in the browser. Google can afford to do this, because it has so many engineers and speed is of paramount importance to search. To achieve fast page loads as well as fast page updates, Google implements pretty much the entire Search front-end in C++ as well as JavaScript. They have been working on a number of projects to make this easier over the past couple of years, but needless to say, such a process is too expensive and slow for a startup or a complex app.</p>

<p>Gmail, Twitter, and other sites rendered only in the client were painfully slow to load. Twitter went through the full circle on this&#8212;they started as a server-rendered Rails app, rewrote to render <a href="http://engineering.twitter.com/2010/09/tech-behind-new-twittercom.html">everything in the client</a>, and then realized it took their users 4 seconds to be able to read a 140 character message. Now, Twitter renders half the page in Scala on the server, and they render the other half in JavaScript in the client. This both makes it more difficult for them to maintain a code base in multiple languages and means that the least important items on the page pop-in a few seconds after page load. People are very sensitive to movement, so in effect, they are distracting their users with the least important information after every page load.</p>

<p>Thanks to the awesome re-invention of JavaScript performance starting with V8 and the ability to easily create JavaScript servers with Node.js, lots of developers are excited about the notion of using JavaScript for both server and client development. But despite finally using the same language, few Node.js applications to date deliver on the amazing ability to share code. Even with a common language, there are still a lot of issues including very different latency and connection stability, separate ways of dealing with URLs on the server and in the browser, the existence of a DOM in the browser and not on the server, and direct access to a filesystem only on the server.</p>

<h2>Let&#8217;s get down to business!</h2>

<p>So after all that, our teams decided to go in similar directions in some ways, but very different in others. Derby&#8217;s goal is to make it possible for any developer to write apps that load as fast as a search engine, are as interactive as a document editor, and work offline. And to <a href="https://groups.google.com/forum/?fromgroups#!topic/derbyjs/pvtbLullSn4">quote Geoff</a>, Meteor&#8217;s goal is to create &#8220;a &#8216;mass-market&#8217; app platform that could be used for 90% of the sites on the web, and for that 90%, make web development faster and within reach of more people.&#8221;</p>

<h3>GPL vs. MIT</h3>

<p>Currently, Meteor is only available under a <a href="http://meteor.com/faq/how-is-meteor-licensed">GPL license</a>. This means that you must contact them and arrange for a commercial license if you do not wish to release your source under the GPL or another compatible license.</p>

<p>Derby, Racer, and all other components of our framework are released under the permissive MIT license. Thus, you can do pretty much anything you want with it (other than sue us), and we can&#8217;t stop you or change our minds later.</p>

<p>I&#8217;m no lawyer, so don&#8217;t take any of what I just said as legal advice; I don&#8217;t have a crystal ball or anything. (Yes, a lawyer once told me to say that.)</p>

<h3>Meteor packages vs. npm</h3>

<p>Meteor has created their own package system and means for distributing packages.</p>

<p>Node.js modules are clearly defined by the CommonJS format and the built-in module APIs. However, it does not include a means for distributing modules. In the early days, Node.js had a few competing package managers, but pretty much everyone has now finalized on using <a href="http://npmjs.org/">npm</a>. It is so universal, that npm is now distributed directly with the official Node.js binary distributions.</p>

<p>Frankly, this is the main thing that concerns me about Meteor. It is likely that many people trying Meteor will never have used Node.js before, and they won&#8217;t appreciate the great benefits of distribution via npm. I and many other developers view npm as one of Node.js&#8217;s core strengths, and I would be very sad to see it weakened by an incompatible package system.</p>

<p>Like pretty much every other Node.js project out there, we primarily distribute Derby, Racer, and all plugins for these projects as npm modules. We will continue to break out our projects into smaller modules so that they can be better reused by others. Perhaps you don&#8217;t use Derby, but you need to parse some HTML. We had to write a simple and fast HTML parser for our templates to work, so you&#8217;ll be able to use just that in any Node.js project. <a href="http://www.senchalabs.org/connect/">Connect</a> is great example of a project that has a rich ecosystem of middleware designed to work with it that are all distributed via npm, and we hope to follow in the same pattern.</p>

<h3>Compatibility with other libraries</h3>

<p>Meteor makes it possible to replace parts of it with other libraries. It is especially flexible when it comes to substituting in client-side libraries, though those libraries must first be wrapped as a Meteor package.</p>

<p>Meteor mostly manages the creation of a server in a custom way. This makes it easy to create and deploy a Meteor app to their hosting service, but it makes it much harder to use Meteor as a module of a more traditional Node.js server.</p>

<p>In contrast, Derby is just a normal npm module that you can add to any Node.js server. If you want to use any of the <a href="http://search.npmjs.org/">8900 packages</a> in npm (at the moment), simply add them to your package.json file and <code>npm install</code> away!</p>

<p>Derby does not provide any sort of hosting solution, though there are lots of great hosting services for Node.js out there. We will provide better instructions for how to get Derby apps up and running quickly on a public server in the future.</p>

<p><a href="http://derbyjs.com/#introduction_to_racer">Racer</a> (the realtime engine powering Derby&#8217;s models) is a separate module, and it can be used independently of Derby. You could hook pretty much any UI layer up to Racer and handle the methods that it emits as the model is updated. Racer is built on top of the very popular <a href="http://socket.io/">Socket.IO</a> module, which you can use directly if you need to.</p>

<p>Derby also uses popular modules at its core, especially <a href="http://expressjs.com/">Express</a> for routing and <a href="https://github.com/substack/node-browserify">Browserify</a>, which can bundle up most Node.js modules for the browser automatically.</p>

<h3>MongoDB API vs. Racer methods</h3>

<p>Meteor takes the MongoDB API all the way to the browser. The MongoDB API is powerful and easy to use from JavaScript. It has also been around for some time, so there are well established patterns for using it do most things that an application might need to do. A lot of people seem to think this is a fun way to build apps, and it reduces need to understand multiple layers of abstraction. Some have expressed concerns over the security implications, but I think we should reserve judgment until the Meteor team has more time to address what they think is the best approach for authentication and authorization.</p>

<p>Racer has its own API based around a set of mutator methods and paths. This API maps pretty much 1:1 with any document store, including MongoDB. This has some pluses and minuses, but we believe it is the right choice for a few reasons:</p>

<h4>Conflict resolution</h4>

<p>Paths and methods map well to conflict detection techniques that we think will be one of the major benefits of using Racer. For now, our default mode is last-writer-wins, which is equivalent to how Meteor saves data. However, we have preliminary implementations of conflict resolution via Software Transactional Memory and Operational Transformation methods. Such techniques will make it possible to use a Derby app offline and then resync correctly. It will also make it possible to easily add features like Google-Docs-style realtime collaborative text editing in any text box.</p>

<h4>Datastore portability</h4>

<p>Our paths and methods are granular enough to take advantage of the capabilities of most datastores, but it is possible to switch from one datastore to another or to use them with multiple datastores simultaneously. Swapping in Riak, Postgres, CouchDB, or another service should be straightforward without modifying application code.</p>

<h4>Efficient PubSub</h4>

<p>Paths map well to PubSub, which is how we propagate changes in realtime. In contrast, Meteor&#8217;s LiveMongo implementation simply writes to the database and polls it frequently for the data in use by every connected client. The advantage to polling is that it can support subscriptions to pretty much any kind of Mongo query, but we have implemented most queries and query PubSub without needing to poll the database. We have no real-world evidence yet, but we expect PubSub to scale much better than database polling.</p>

<h4>API plugins</h4>

<p>It will be possible to create plugins that act like datastores, even though they are communicating with a backend service or a 3rd party API. Database adapters are built on top of a system of routes that can be used in a custom manner.</p>

<h3>Server rendering and shared routes</h3>

<p>Derby is one of the only frameworks designed to run all rendering and routing code on the server and in the browser. It&#8217;s even possible to use Derby to render static pages that share templates with dynamic apps.</p>

<p>This means you get crazy fast page loads with no effort. Even for a simple client-rendered app, pages typically take a second or two to load and then be displayed to the user. Simple Derby apps can fire the onload event in less than 200ms. As apps get more complex, server rendering has an even more drastic effect.</p>

<p>Lots of big companies including Google, Amazon, and Facebook dedicate massive resources to optimizing page load time, because it directly translates into better conversion rates and more revenue. I died a little bit inside the day Gmail added a loading progress bar. Don&#8217;t do that.</p>

<p>In addition, server-rendering is critical for search engine optimization, and it provides accessibility to screen readers and browsers without JavaScript.</p>

<p>Derby exposes <a href="http://derbyjs.com/#routes">routes</a> as an Express middleware on the server, so you can use it alongside other server-only Express routes for tasks like uploading files, and you can even write multiple apps that handle different sets of routes on the same Express server. For example, you might write a separate admin app or a separate mobile app that doesn&#8217;t load all of the code for a desktop browser app.</p>

<p>While Derby gives you all of the speed and accessibility advantages of a more traditional multi-page app, it also creates fully optimized single-page applications that can render any template or route in the browser. Client-side routes simply render any links that they can without doing a page refresh; you don&#8217;t have to call methods on a special browser-side routing API. Just put a normal HTML link on the page, and Derby will render it client-side.</p>

<p>Meteor does not have these features yet, though they recently rewrote their templating engine to use strings so that it is now <a href="http://meteor.com/faq/can-meteor-serve-static-html">possible for them to add</a>.</p>

<h3>Model-view data bindings</h3>

<p>Meteor uses a reactive functional programming approach to updating templates that could potentially work with any template engine. As a template is rendered, all of the data that is used to render that template is assumed to be an input to that chunk of the UI. Later, when that data changes, the template is re-rendered, and its output is compared with the DOM. Meteor then patches up the DOM to apply the minimum required changes. Effectively, every single variable and function in a template is bound. The big advantage to this approach is its simplicity and ability to support any template language.</p>

<p>In contrast, Derby has its own template language based on Handlebars. <a href="http://derbyjs.com/#bindings">Bindings</a> are declared explicitly, and the HTML of the template is parsed in order to figure out which parts of the DOM need to be updated. Unlike Meteor&#8217;s, Derby&#8217;s bindings are two way; when form elements are bound, the model is automatically updated as users type in text inputs, check checkboxes, and select items in drop downs. In addition, it is possible to bind everything or to optimize the performance of templates by only binding what is necessary. Outputting non-bound data may also be preferred if a developer wishes to update the view via manual DOM manipulation in special cases.</p>

<h3>DOM event handlers</h3>

<p>It is a relatively minor difference, but Meteor uses CSS selectors on specific templates, and Derby uses HTML attributes within templates to declare event handlers. <a href="http://api.jquery.com/category/events/">jQuery</a> and <a href="http://documentcloud.github.com/backbone/#View-delegateEvents">Backbone</a> have popularized the CSS selector method of scoping event handlers. <a href="http://knockoutjs.com/documentation/event-binding.html">Knockout</a> and <a href="http://docs.angularjs.org/#!/tutorial/step_10">Angular</a> use HTML attributes.</p>

<p>We prefer the <a href="http://derbyjs.com/#dom_event_binding">HTML markup approach</a>, because it is more work to figure out what CSS selector matches the correct elements, and it is reasonably likely that HTML structure will change and silently break CSS selectors. With the markup approach, it is less likely that function names will be changed inadvertently, and an error will be thrown when the function can no longer be found.</p>

<p>Derby also has an innovative approach to event bubbling that is more efficient and intuitive compared to typical event bubbling. Instead of bubbling up the entire DOM to the root documentElement for every event, Derby will stop bubbling once it finds an element that is bound to the event. Like with routes, bubbling can be continued by calling a <code>next()</code> method passed to the event handler.</p>

<h3>Fibers</h3>

<p>Meteor uses the <a href="https://github.com/laverdet/node-fibers">Fibers</a> extension for Node.js that makes it possible to write synchronous looking code on the server instead of the more common callback style used by most Node.js projects. Some prefer this way of writing asynchronous code, others strongly disagree with it. There are a number of arguments on both sides.</p>

<p>This is very contentious issue at the moment, and we prefer to stay out of it. A <a href="http://www.mikealrogers.com/posts/a-vocal-minority.html">very small percentage</a> of modules in npm are written this way, so we have stuck to the more traditional Node.js style of callbacks.</p>

<h2>Wrapping it up</h2>

<p>You can achieve many of the same things with both frameworks. Both are powerful tools for implementing features that are very difficult to write in more traditional web frameworks like Rails and PHP.</p>

<p>Derby has been more focused on making sure it can support advanced features like conflict detection, offline clients, and extremely fast rendering. We are also more focused on compatibility with other modules in the existing Node.js ecosystem, and we have a permissive open source license.</p>

<p>Ultimately, we are all trying to create the best tools for developers, and competition can help to breed innovation. We are happy to see other approaches like <a href="http://meteor.com/">Meteor</a>, <a href="http://spacemagic.io/">SpaceMagic</a>, and <a href="http://www.firebase.com/">Firebase</a>, because we will all learn from each other. We will end up with better tools, a better web, and better experiences for users.</p>

<p>If you&#8217;re interested in what we&#8217;re working on, follow us on <a href="https://twitter.com/#!/derbyjs">Twitter</a> and <a href="https://github.com/codeparty/derby/">GitHub</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/04/13/derby-v0-dot-3-0/">Derby v0.3.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-13T22:19:00-07:00" pubdate data-updated="true">Apr 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a big release for us&#8212;Derby finally has support for automatic persistence! Initially we have support for MongoDB, and it will be possible to swap in anything else through use of a different adapter.</p>

<p>In addition, we have added support for subscriptions to queries and made big upgrades to the power of the HTML templates. Templates now support reactive helper functions, and we have replaced partials with more flexible HTML components.</p>

<p>By the way, you may have noticed that we skipped v0.2. We are following the common convention <code>major.minor.patchlevel</code> where odd minor versions are unstable. Node.js, the Linux kernel, Redis, and lots of other projects follow this convention. Since odd minor versions are unstable, patch level versions will likely break APIs. Patch level updates to even numbered versions will only include bug fixes. The first such stable version will likely be v0.4.0.</p>

<h2>Want some database with that realtime syncing?</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// No persistence</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">listen</span><span class="o">:</span> <span class="nx">server</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Persistence-a-go-go</span>
</span><span class='line'><span class="nx">derby</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;racer-db-mongo&#39;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">listen</span><span class="o">:</span>  <span class="nx">server</span>
</span><span class='line'><span class="p">,</span> <span class="nx">db</span><span class="o">:</span>      <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Mongo&#39;</span><span class="p">,</span> <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;mongodb://localhost/database&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>No, seriously, it is two lines of code.</p>

<p>All of the db adapters will be released as separate npm modules. As with all npm modules, you need to add a dependency to your <code>package.json</code> file and then re-run <code>$ npm install</code> in order to require it.</p>

<h3>Behind the scenes</h3>

<p>Racer (the realtime engine powering Derby&#8217;s models) describes all data mutations in terms of a method, path, and some arguments. These methods, e.g. <code>set</code>, <code>push</code>, etc., can be thought of like the HTTP verbs, such as <code>POST</code>, <code>PUT</code>, and <code>DELETE</code>. Model paths are like URLs to a specific piece of data, and the method arguments are like the content of a request. Just as a REST API can be defined in terms of HTTP verbs and URLs, Racer has a routing system for mutation methods and paths.</p>

<p>By default, Racer uses a basic in-memory datastore that defines these store routes for each mutation method and path pattern. Database adapters like the Mongo adapter do the same thing, implementing each method in a database-specifc way. Because these routes can handle any method on any path, no additional server code needs to be written in order to persist data.</p>

<p>It is possible to add custom store routes for specifc paths if an application connects to an external API. Such routes could be provided as a generic plugin for Racer that makes it dead simple for other developers to use an API with Racer&#8217;s automatically synced models. More documentaion on store routes will be coming soon.</p>

<h3>So where is the data saved?</h3>

<p>Racer paths are translated into database collections and documents using a natural mapping:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>collection.documentId.document
</span></code></pre></td></tr></table></div></figure>


<p>All synced paths (anything that doesn&#8217;t start with an underscore) must follow this convention. In other words, all model data stored at the first two path segments should be an object and not a string, number, or other primitive type.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Examples:</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;todos.id_0.completed&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;rooms.lobby.messages.5.text&#39;</span><span class="p">,</span> <span class="s1">&#39;Call me&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">app</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Hi there&#39;</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;Erik Mathers&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The first and second segments in root paths must be objects</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Hi there&#39;</span><span class="p">)</span>      <span class="c1">// WARNING INVALID</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;app.title&#39;</span><span class="p">,</span> <span class="s1">&#39;Hi there&#39;</span><span class="p">)</span>  <span class="c1">// WARNING INVALID</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// However, any type may be stored at any private path, which</span>
</span><span class='line'><span class="c1">// starts with an underscore and is not synced back to the server</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;_title&#39;</span><span class="p">,</span> <span class="s1">&#39;Hi there&#39;</span><span class="p">)</span>     <span class="c1">// OK</span>
</span></code></pre></td></tr></table></div></figure>


<p>The document&#8217;s id (the second path segment) is automatically added as the <code>id</code> property of the document, so that it can be retrieved from the datastore.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">app</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Hi there&#39;</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;Erik Mathers&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;meta.app&#39;</span><span class="p">))</span>
</span><span class='line'><span class="c1">// Logs: {</span>
</span><span class='line'><span class="c1">//   id: &#39;app&#39;</span>
</span><span class='line'><span class="c1">// , title: &#39;Hi there&#39;</span>
</span><span class='line'><span class="c1">// , author: &#39;Erik Mathers&#39;</span>
</span><span class='line'><span class="c1">// }</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Queries &#8212; we do &#8216;em live!</h2>

<p>Racer has always had granular PubSub based on path patterns. In addition, it is now possible to specify subscriptions in terms of a more expressive query syntax. These queries are similar to most database queries, except that they can automatically detect when new data matches and then sync that data to all appropriate clients.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:groupName&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">groupPath</span> <span class="o">=</span> <span class="s1">&#39;groups.&#39;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">groupName</span>
</span><span class='line'>    <span class="p">,</span> <span class="nx">todosQuery</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;todos&#39;</span><span class="p">).</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">groupName</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">model</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">groupPath</span><span class="p">,</span> <span class="nx">todosQuery</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this example, a query is used to limit a client&#8217;s subscription to only <code>todos</code> that have a property <code>group</code> with the same name as the current group. The query syntax supports most common query operations, such as key lookups, numerical comparisons, sorts, and limits. See <a href="http://derbyjs.com/#queries">the documentation</a> for more info.</p>

<h2>A quick note on syntax changes</h2>

<p>This release changes a number of items in Derby&#8217;s template syntax:</p>

<ul>
<li>Bound template tags used to be wrapped in double or triple parentheses instead of curly braces. Instead, they are now wrapped in single curly braces. Now a bound variable looks like <code>&lt;input value="{.text}"&gt;</code>. All of the parentheses started to get confusing with the addition of view helper functions, and the new syntax is much easier on the eyes. To output a left curly brace in HTML, use the entity <code>&amp;#123;</code>. Conveniently, it&#8217;s an easy one to remember.</li>
<li>Instead of triple curlies, there is now an unescaped keyword. For example, what was previously <code>{{{rawHtml}}}</code> is now <code>{{unescaped rawHtml}}</code> and what was previously <code>(((rawHtml)))</code> is now <code>{unescaped rawHtml}</code>. This is more readable and keeps the braces consistent.</li>
<li>Also for readability, path aliases in templates must now be proceeded by an <code>as</code> keyword. For example, <code>{{#each items as :item}}</code>.</li>
<li>Handlebars-style partials have been removed in favor of a more powerful component system that looks like custom HTML tags. More on this below, but what was previously <code>{{&gt; nav}}</code> is now <code>&lt;app:nav&gt;</code>. Inside of HTML attribute values, developers should now use view helper functions instead of partials.</li>
<li>Triple curly braces have been re-purposed for the much more awesome function of macro template tags inside of components. More on this below.</li>
<li>The hacky <code>disabled="!((active))"</code> syntax that was previously supported only for boolean HTML attributes has been removed in favor of the built-in <code>not</code> helper function. This should now be <code>disabled="{not(active)}"</code>.</li>
</ul>


<p>We realize changes like this are annoying, and we don&#8217;t expect to be making any more major changes to the template syntax after this. We have some additional features planned for components, but they should be backwards compatible with this current release.</p>

<h2>Sometimes views need a little help(er)</h2>

<p>We follow the logic-less templating approach of Handlebars and Mustache, which helps to better organize controller code. However, we found that we kept having to add data to the model just for the purpose of binding computed values. This got tedious, and didn&#8217;t work well with computed properties of each item in a list.</p>

<p>Therefore, we added reactive view helper functions. These functions get evaluted when rendering as well as whenever their inputs change. In addition, they can work as both getters and setters. This is super useful when binding to form elements, such as selected options or radio buttons:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Remove all whitespace from a string</span>
</span><span class='line'><span class="nx">view</span><span class="p">.</span><span class="nx">fn</span><span class="p">(</span><span class="s1">&#39;unspace&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{{#with home}}
</span><span class='line'>  <span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">&quot;color:{unspace(.title.color)}&quot;</span><span class="nt">&gt;</span>Welcome in {.title.color}!<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>  <span class="nt">&lt;select&gt;</span>
</span><span class='line'>    {#each .colors}
</span><span class='line'>      <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">&quot;{equal(.name, home.title.color)}&quot;</span><span class="nt">&gt;</span>{{.name}}<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>    {/}
</span><span class='line'>  <span class="nt">&lt;/select&gt;</span>
</span><span class='line'>{{/}}
</span></code></pre></td></tr></table></div></figure>


<p>There are two default view helper functions, <code>equal</code> and <code>not</code>, that are aways available. It is also possible to define custom view helper functions, such as <code>unspace</code> in the example above. The <code>equal</code> and <code>not</code> functions can act as both getters and setters. In this example, when the page renders, the option with a name equal to the value of <code>home.title.color</code> will have a <code>selected</code> attribute and the others will not. When the user selects a different option from the drop down, <code>home.title.color</code> will be set to the value of the option that is now selected.</p>

<h2>Components are the new <s>partials</s> hotness</h2>

<p>Previously, Derby templates only supported simple partials like Handlebars. We have replaced partials with a much more powerful concept of components that can take attribute arguments and even different HTML content. Components are defined in the same way that partials were previously defined, but they are included in other templates like custom HTML tags. When Derby parses the templates, it replaces these custom component tags with the components&#8217; contents, and the custom tags do not appear in the HTML output.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;&lt;app:greeting&gt;&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;greeting:&gt;</span>
</span><span class='line'>  Hello!
</span></code></pre></td></tr></table></div></figure>


<p>For now, all component includes start with the namespace <code>app</code>. This prevents potential conflicts with normal HTML tags, and it makes it clear which HTML tags are components that should be replaced. In the future, it will be possible to define component libraries with their own namespaces.</p>

<p>Literal values or variable values can be passed to components. These component attributes are available through &#8220;macro&#8221; template tags, which have triple curly braces. Macro template tags only reference component attribute names, and regular template tags (with one or two curly braces) only reference names from the model or context object. It is possible to use macro template tags to conditionally render any HTML content or other template tags.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;&lt;app:greeting</span> <span class="na">message=</span><span class="s">&quot;Hello&quot;</span> <span class="na">to=</span><span class="s">&quot;{_user.name}&quot;</span><span class="nt">&gt;&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;greeting:&gt;</span>
</span><span class='line'>  {{{#if to}}}
</span><span class='line'>    {{{message}}}, {{{to}}}!
</span><span class='line'>  {{{else}}}
</span><span class='line'>    {{{message}}}!
</span><span class='line'>  {{{/}}}
</span></code></pre></td></tr></table></div></figure>


<p>produces the same output as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;</span>
</span><span class='line'>    {#if _user.name}
</span><span class='line'>      Hello, {_user.name}!
</span><span class='line'>    {else}
</span><span class='line'>      Hello!
</span><span class='line'>    {/}
</span><span class='line'>  <span class="nt">&lt;/h1&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>By default, all components are void HTML elements. This means that they must only have an opening tag and no closing tag, just like the <code>&lt;img&gt;</code> and <code>&lt;br&gt;</code> elements. A component can be defined as nonvoid, which means that it must have both a starting and a closing tag. Nonvoid components have access to a special <code>content</code> macro that makes it possible to pass HTML content to the component. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  Welcome!
</span><span class='line'>  <span class="nt">&lt;app:fancyButton&gt;</span>
</span><span class='line'>    <span class="nt">&lt;b&gt;</span>Click me {{#if isUrgent}}now!{{/}}<span class="nt">&lt;/b&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/app:fancyButton&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;fancyButton:</span> <span class="na">nonvoid</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;fancy&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    {{{content}}}
</span><span class='line'>  <span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>produces the same output as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  Welcome!
</span><span class='line'>  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;fancy&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;b&gt;</span>Click me {{#if isUrgent}}now!{{/}}<span class="nt">&lt;/b&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Components make it possible to write more expressive templates and reduce repeated boilerplate. We will continue to extend components and add support for creating reusable component libraries.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/03/25/derby-v0-dot-1-10/">Derby v0.1.10</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-25T19:34:00-07:00" pubdate data-updated="true">Mar 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This release significantly improves templates and event bindings. It also fixes a ton of bugs, so get on it!</p>

<h2>Namespaces to the rescue!</h2>

<p>Creating apps with many pages is now simple thanks to the addition of <a href="http://derbyjs.com/#importing_templates">namespaced templates</a>. The new template import syntax makes it easy to break up templates into multiple pages. Then, a namespace can be passed to <code>view.render()</code> to specify which page to render. Namespaces could also represent different application states or be used to break up really complex pages into multiple independent sets of templates.</p>

<h4>home.html</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  Welcome to the home page
</span></code></pre></td></tr></table></div></figure>


<h4>contact.html</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  Give us a call sometime
</span></code></pre></td></tr></table></div></figure>


<h4>index.html</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;import:</span> <span class="na">src=</span><span class="s">&quot;home&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;import:</span> <span class="na">src=</span><span class="s">&quot;contact&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;Header:&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;</span>Awesome town<span class="nt">&lt;/h1&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>index.js</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">page</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/contact-us&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">page</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;contact&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Growing out the Mustache</h2>

<p>Derby templates have moved from <a href="http://mustache.github.com/mustache.5.html">Mustache</a> style conditional blocks to <a href="http://handlebarsjs.com/">Handlebars</a> style. This is a relatively minor change, but we think it makes templates more readable. This is helpful for those less familiar with Mustache syntax and for reading templates that others have written.</p>

<p>What was previously:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  {{#users}}
</span><span class='line'>    <span class="nt">&lt;h3&gt;</span>{{name}}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>    {{#active}}
</span><span class='line'>      Thanks for your active support!
</span><span class='line'>    {{^}}
</span><span class='line'>      We&#39;d love to see you more often.
</span><span class='line'>    {{/}}
</span><span class='line'>  {{/}}
</span></code></pre></td></tr></table></div></figure>


<p>Now is written:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  {{#each users}}
</span><span class='line'>    <span class="nt">&lt;h3&gt;</span>{{name}}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>    {{#if active}}
</span><span class='line'>      Thanks for your active support!
</span><span class='line'>    {{else}}
</span><span class='line'>      We&#39;d love to see you more often.
</span><span class='line'>    {{/}}
</span><span class='line'>  {{/}}
</span></code></pre></td></tr></table></div></figure>


<p>For more detail, see <a href="http://derbyjs.com/#template_syntax">Template Syntax</a> in the docs.</p>

<h2>Event bubbling done right</h2>

<p>Derby makes <a href="http://derbyjs.com/#dom_event_binding">binding to DOM events</a> fast and easy via the <code>x-bind</code> attribute in templates. Previously, events only were detected when they were the target. Now events bubble up to parent elements, and they emit the event object with a reference to the target as well as the element that was bound via <code>x-bind</code>.</p>

<p>Unlike the <a href="https://developer.mozilla.org/en/DOM/event">DOM Event Model</a>, the event is only called on the first handler that matches. It will only continue bubbling if a <code>next()</code> function is called, similar to how routes can pass control to the next route. This is a more efficient and less error-prone way of bubbling than requiring listeners to call a method like <code>e.stopPropogation()</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- The root element will handle a click anywhere in the window. --&gt;</span>
</span><span class='line'><span class="nt">&lt;Root:&gt;</span>
</span><span class='line'>  <span class="nt">&lt;html</span> <span class="na">x-bind=</span><span class="s">&quot;click: deselect&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;Body:&gt;</span>
</span><span class='line'>  {{#each items}}
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">x-bind=</span><span class="s">&quot;click: select&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h3&gt;</span>{{name}}<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;{{image}}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  {{/}}
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">exports</span><span class="p">.</span><span class="nx">select</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">selectedId</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// There is no need to check the target of the click event, since it</span>
</span><span class='line'><span class="c1">// will only bubble up if the click was outside of one of the items.</span>
</span><span class='line'><span class="nx">exports</span><span class="p">.</span><span class="nx">deselect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">selectedId</span><span class="p">.</span><span class="nx">del</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Even the error messages are fast</h2>

<p>For faster development, we added live-updating as files are edited in the last release. However, any errors would still kill the server and require a manual restart. Template and CSS error handling is now much improved, and errors with either of these are displayed in the browser as files are saved. Even better, the page updates and the error message disappears as soon as the error is corrected.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/03/09/derby-v0-dot-1-9/">Derby v0.1.9</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-09T10:31:00-08:00" pubdate data-updated="true">Mar 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The latest release of Derby includes easier installation without Redis; automatic reloading of scripts, templates, and styles; better subscription functionality; and lots of bug fixes.</p>

<h2>Modularity FTW</h2>

<p>In preparation for adding persistent storage, we have finished a <em>major</em> refactor of Racer, the realtime model engine for Derby. The latest release includes the ability to plugin various functionality, and there will be separate plugins for different database, journal, and PubSub adapters. We already have preliminary plugins for a MongoDB database, Redis journal, and Redis PubSub, though we are still working on some bugs.</p>

<p>Another awesome benefit of the refactor is that Redis is no longer required by default, and you can now start playing around with Derby after a simple <code>npm install -g derby</code>.</p>

<h2>Command-S and kick back</h2>

<p>Thanks to <a href="https://github.com/LearnBoost/up">Up</a> and Node.js v0.6&#8217;s <a href="http://nodejs.org/api/fs.html#fs_fs_watchfile_filename_options_listener"><code>fs.watchFile</code></a>, Derby now supports automatic page updates in development. Derby&#8217;s new <code>derby.run</code> method starts a server via Up and reloads the server whenever any script files in the project are saved.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;derby&#39;</span><span class="p">).</span><span class="nx">run</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/lib/server&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In development, the browser will automatically reload when it reconnects and notices that the server has a new version. Simply generate a new project via</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">derby</span> <span class="k">new</span> <span class="nx">project</span><span class="o">-</span><span class="nx">name</span>
</span></code></pre></td></tr></table></div></figure>


<p>and it will be set up to use this feature.</p>

<p>In addition, saving style files will automatically recompile CSS and update connected browsers. Saving template files will re-render the page in connected browsers. Get a big monitor and tweak those styles like it&#8217;s nobody&#8217;s business!</p>

<h2>Subscribe &#8211; now with less whack!</h2>

<p>The <a href="http://derbyjs.com/#subscription"><code>model.subscribe()</code></a> method has been simplified to take advantage of <a href="http://derbyjs.com/#scoped_models">scoped models</a>. Previously, the format for subscribe was the somewhat wacky:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// WARNING: Old API</span>
</span><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span><span class="nx">_room</span><span class="o">:</span> <span class="s1">&#39;rooms.&#39;</span> <span class="o">+</span> <span class="nx">roomName</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;_room.stuff&#39;</span><span class="p">))</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The new format is more clear:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">model</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;rooms.&#39;</span> <span class="o">+</span> <span class="nx">roomName</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">model</span><span class="p">.</span><span class="nx">ref</span><span class="p">(</span><span class="s1">&#39;_room&#39;</span><span class="p">,</span> <span class="nx">room</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">room</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;stuff&#39;</span><span class="p">))</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is also a new method <code>model.fetch()</code>, which has the same format as subscribe. However, it only gets data from the store and sets it in the model. It does not create any subscriptions to ongoing updates, and it does not require the use of PubSub.</p>

<p>Subscribe and fetch will also support queries, though the implementation is still being finalized.</p>

<h2>Seriously, we are going support MongoDB soon</h2>

<p>I know this has been a long time coming&#8212;persistence is just around the corner. We have it mostly working with the Todos example, but we are still working through some bugs. Note that adding persistence will simply require configuring the store in the server file. It will look something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// No persistence</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span> <span class="nx">listen</span><span class="o">:</span> <span class="nx">server</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Persistence-a-go-go</span>
</span><span class='line'>
</span><span class='line'><span class="nx">derby</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;racer-journal-redis&#39;</span><span class="p">))</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;racer-pubsub-redis&#39;</span><span class="p">))</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;racer-db-mongo&#39;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">createStore</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">listen</span><span class="o">:</span>  <span class="nx">server</span>
</span><span class='line'><span class="p">,</span> <span class="nx">journal</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Redis&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">,</span> <span class="nx">pubSub</span><span class="o">:</span>  <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Redis&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">,</span> <span class="nx">db</span><span class="o">:</span>      <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Mongo&#39;</span><span class="p">,</span> <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;mongodb://localhost/database&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>It shouldn&#8217;t require any changes to your application code, and it won&#8217;t affect the model API, so go ahead and prototype with the current version of Derby.</p>

<p>Note that if you try out this out now, bad things will happen. But hey, the code is on the Internet, so someone is obviously going to do it. Just know that it isn&#8217;t supposed to work yet.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/06/04/derby-v0-dot-5-0/">Derby v0.5.0</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/04/migrating-from-derby-0-dot-3-to-0-dot-5/">Migrating from Derby 0.3 to 0.5</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/10/preview-of-racer-0-dot-5-and-sharejs-for-scalable-derby-apps/">Preview of Racer 0.5 and ShareJS for scalable Derby apps</a>
      </li>
    
      <li class="post">
        <a href="/2013/03/26/getting-derby-ready-for-prime-time/">Getting Derby ready for prime time</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/03/now-hiring-join-the-derby-core-team-at-lever/">Now hiring: Join the Derby core team at Lever</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("derbyjs", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/derbyjs" class="twitter-follow-button" data-show-count="false">Follow @derbyjs</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Nate Smith and Brian Noguchi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'derbyblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
